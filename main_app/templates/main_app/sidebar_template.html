{% load static %}
<aside class="main-sidebar sidebar-dark-primary elevation-4">
{% if request.user.user_type == '1' %}
    <!-- Brand Logo -->
    <a href="{% url 'admin_home' %}" class="brand-link">
        <img src="{% static 'dist/img/AdminLTELogo.png' %}" alt="AdminLTE Logo"
            class="brand-image img-circle elevation-3" style="opacity: .8">
        <span class="brand-text font-weight-light">Admin Panel</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
        <!-- Sidebar user panel (optional) -->
        <div class="user-panel mt-3 pb-3 mb-3 d-flex">
            <div class="image">
                <img src="{{ request.user.profile_pic}}" class="img-circle elevation-2 pulse-avatar" alt="User Image">
            </div>
            <div class="info">
                {% url 'admin_view_profile' as admin_view_profile %}
                <a href="{{admin_view_profile}}" class="d-block text-bold">{{user}}</a>
            </div>
        </div>

        <!-- Sidebar Menu -->
        <nav class="mt-2">
            <ul class="nav nav-pills nav-sidebar flex-column nav-child-indent nav-compact" data-widget="treeview" role="menu" data-accordion="false">

                <li class="nav-item">
                    {% url 'admin_home' as admin_home %}
                    <a href="{{admin_home}}" class="nav-link {% if admin_home == request.path %} active {% endif %}">
                        <i class="nav-icon fas fa-home"></i>
                        <p>Home</p>
                    </a>
                </li>

                {% url 'add_employee' as add_employee %}
                {% url 'manage_employee' as manage_employee %}
                {% url 'edit_employee' employee_id as edit_employee %}
                <li class="nav-item has-treeview {% if add_employee == request.path or manage_employee == request.path or edit_employee == request.path %} menu-open {% endif %}">
                    <a href="#" class="nav-link {% if add_employee == request.path or manage_employee == request.path or edit_employee == request.path %} active {% endif %}">
                        <i class="nav-icon fas fa-users"></i>
                        <p>
                            Employee Management
                            <i class="right fas fa-angle-left"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a href="{{add_employee}}" class="nav-link {% if add_employee == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-user-plus"></i>
                                <p>Add Employees</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{manage_employee}}" class="nav-link {% if edit_employee == request.path or manage_employee == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-user-cog"></i>
                                <p>Manage Employee</p>
                            </a>
                        </li>
                    </ul>
                </li>

                {% url 'add_manager' as add_manager %}
                {% url 'manage_manager' as manage_manager %}
                {% url 'edit_manager' manager_id as edit_manager %}
                <li class="nav-item has-treeview {% if add_manager == request.path or manage_manager == request.path or edit_manager == request.path %} menu-open {% endif %}">
                    <a href="#" class="nav-link {% if add_manager == request.path or manage_manager == request.path or edit_manager == request.path %} active {% endif %}">
                        <i class="nav-icon fas fa-user-tie"></i>
                        <p>
                            Manager Management
                            <i class="right fas fa-angle-left"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a href="{{add_manager}}" class="nav-link {% if add_manager == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-user-plus"></i>
                                <p>Add Manager</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{manage_manager}}" class="nav-link {% if manage_manager == request.path or edit_manager == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-user-cog"></i>
                                <p>Manage Manager</p>
                            </a>
                        </li>
                    </ul>
                </li>

                {% url 'add_division' as add_division %}
                {% url 'manage_division' as manage_division %}
                {% url 'edit_division' division_id as edit_division %}
                {% url 'add_department' as add_department %}
                {% url 'manage_department' as manage_department %}
                {% url 'edit_department' department_id as edit_department %}
                <li class="nav-item has-treeview {% if add_division == request.path or manage_division == request.path or edit_division == request.path or add_department == request.path or manage_department == request.path or edit_department == request.path %} menu-open {% endif %}">
                    <a href="#" class="nav-link {% if add_division == request.path or manage_division == request.path or edit_division == request.path or add_department == request.path or manage_department == request.path or edit_department == request.path %} active {% endif %}">
                        <i class="nav-icon fas fa-sitemap"></i>
                        <p>
                            Organization Management
                            <i class="right fas fa-angle-left"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a href="{{add_division}}" class="nav-link {% if add_division == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-plus-circle"></i>
                                <p>Add Division</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{manage_division}}" class="nav-link {% if edit_division == request.path or manage_division == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-cogs"></i>
                                <p>Manage Division</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{add_department}}" class="nav-link {% if add_department == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-plus-circle"></i>
                                <p>Add Department</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{manage_department}}" class="nav-link {% if edit_department == request.path or manage_department == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-cogs"></i>
                                <p>Manage Department</p>
                            </a>
                        </li>
                    </ul>
                </li>

                {% url 'employee_feedback_message' as employee_feedback_message %}
                {% url 'manager_feedback_message' as manager_feedback_message %}
                {% url 'admin_notify_manager' as admin_notify_manager %}
                {% url 'admin_notify_employee' as admin_notify_employee %}
                <li class="nav-item has-treeview {% if employee_feedback_message == request.path or manager_feedback_message == request.path or admin_notify_manager == request.path or admin_notify_employee == request.path %} menu-open {% endif %}">
                    <a href="#" class="nav-link {% if employee_feedback_message == request.path or manager_feedback_message == request.path or admin_notify_manager == request.path or admin_notify_employee == request.path %} active {% endif %}">
                        <i class="nav-icon fas fa-comments"></i>
                        <p>
                            Communication
                            <i class="right fas fa-angle-left"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a href="{{ employee_feedback_message }}" class="nav-link {% if employee_feedback_message == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-comment-alt"></i>
                                <p>
                                    Employee Feedback
                                    {% if employee_feedback_count > 0 %}
                                    <span class="badge badge-danger right">{{ employee_feedback_count }}</span>
                                    {% endif %}
                                </p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{manager_feedback_message}}" class="nav-link {% if manager_feedback_message == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-comment-dots"></i>
                                <p>
                                    Manager Feedback
                                    {% if manager_feedback_count > 0 %}
                                    <span class="badge badge-danger right">{{ manager_feedback_count }}</span>
                                    {% endif %}
                                </p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{admin_notify_manager}}" class="nav-link {% if admin_notify_manager == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-bell"></i>
                                <p>Notify Manager</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{admin_notify_employee}}" class="nav-link {% if admin_notify_employee == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-bell"></i>
                                <p>Notify Employee</p>
                            </a>
                        </li>
                    </ul>
                </li>

                {% url 'admin_take_manager_attendance' as admin_take_manager_attendance %}
                {% url 'admin_update_attendance' as admin_update_attendance %}
                {% url 'admin_view_manager_attendance' as admin_view_manager_attendance %}
                {% url 'admin_view_attendance' as admin_view_attendance %}
                <li class="nav-item has-treeview {% if admin_take_manager_attendance == request.path or admin_update_attendance == request.path or admin_view_manager_attendance == request.path or admin_view_attendance == request.path %} menu-open {% endif %}">
                    <a href="#" class="nav-link {% if admin_take_manager_attendance == request.path or admin_update_attendance == request.path or admin_view_manager_attendance == request.path or admin_view_attendance == request.path %} active {% endif %}">
                        <i class="nav-icon fas fa-calendar-check"></i>
                        <p>
                            Attendance
                            <i class="right fas fa-angle-left"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a href= "{{admin_take_manager_attendance}}" class="nav-link {% if admin_take_manager_attendance == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-clipboard-check"></i>
                                <p>Take Attendance</p>
                            </a>
                        </li>
                       
                        <li class="nav-item">
                            <a href= "{{admin_update_attendance}}" class="nav-link {% if admin_update_attendance == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-user-tie"></i>
                                <p>Update Attendance</p>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="{{admin_view_manager_attendance}}" class="nav-link {% if admin_view_manager_attendance == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-calendar-check"></i>
                                <p>Manager Attendance</p>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="{{admin_view_attendance}}" class="nav-link {% if admin_view_attendance == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-users"></i>
                                <p>Employee Attendance</p>
                            </a>
                        </li>
                    </ul>
                </li>
                
                {% url 'view_manager_leave' as view_manager_leave %}
                {% url 'view_employee_leave' as view_employee_leave %}
                <li class="nav-item has-treeview {% if view_manager_leave == request.path or view_employee_leave == request.path %} menu-open {% endif %}">
                    <a href="#" class="nav-link {% if view_manager_leave == request.path or view_employee_leave == request.path %} active {% endif %}">
                        <i class="nav-icon fas fa-calendar-minus"></i>
                        <p>
                            Leave Management
                            <i class="right fas fa-angle-left"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a href="{{view_manager_leave}}" class="nav-link {% if view_manager_leave == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-user-tie"></i>
                                <p>
                                    Manager Leave
                                    {% if manager_leave_count > 0 %}
                                    <span class="badge badge-danger right">{{ manager_leave_count }}</span>
                                    {% endif %}
                                </p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{% url 'view_employee_leave' %}" class="nav-link {% if view_employee_leave == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-user"></i>
                                <p>
                                    Employee Leave
                                    {% if employee_leave_count > 0 %}
                                    <span class="badge badge-danger right">{{ employee_leave_count }}</span>
                                    {% endif %}
                                </p>
                            </a>
                        </li>
                    </ul>
                </li>
                
                <li class="nav-item">
                    {% url 'ceo_rank_report' as ceo_rank_report %}
                    <a href="{{ceo_rank_report}}" class="nav-link {% if ceo_rank_report == request.path %} active {% endif %}">
                        <i class="nav-icon fas fa-chart-bar"></i>
                        <p>Employee Rank Report</p>
                    </a>
                </li>
{% elif request.user.user_type == '2' %}
    <!-- Brand Logo -->
    <a href="{% url 'manager_home' %}" class="brand-link">
        <img src="{% static 'dist/img/AdminLTELogo.png' %}" alt="AdminLTE Logo"
            class="brand-image img-circle elevation-3" style="opacity: .8">
        <span class="brand-text font-weight-light">Manager Panel</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
        <!-- Sidebar user panel (optional) -->
        <div class="user-panel mt-3 pb-3 mb-3 d-flex">
            <div class="image">
                <img src="{{ request.user.profile_pic}}" class="img-circle elevation-2 pulse-avatar" alt="User Image">
            </div>
            <div class="info">
                {% url 'manager_view_profile' as manager_view_profile %}
                <a href="{{manager_view_profile}}" class="d-block text-bold">{{ user}}</a>
            </div>
        </div>

        <!-- Sidebar Menu -->
        <nav class="mt-2">
            <ul class="nav nav-pills nav-sidebar flex-column nav-child-indent nav-compact" data-widget="treeview" role="menu" data-accordion="false">

                <li class="nav-item">
                    {% url 'manager_home' as manager_home %}
                    <a href="{{manager_home}}" class="nav-link {% if manager_home == request.path %} active {% endif %}">
                        <i class="nav-icon fas fa-home"></i>
                        <p>Home</p>
                    </a>
                </li>

                {% url 'manager_update_attendance' as manager_update_attendance %}
                {% url 'manager_take_attendance' as manager_take_attendance %}
                <li class="nav-item has-treeview {% if manager_update_attendance == request.path or manager_take_attendance == request.path %} menu-open {% endif %}">
                    <a href="#" class="nav-link {% if manager_update_attendance == request.path or manager_take_attendance == request.path %} active {% endif %}">
                        <i class="nav-icon fas fa-calendar-check"></i>
                        <p>
                            Attendance Management
                            <i class="right fas fa-angle-left"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">

                    <li class="nav-item">
                            <a href="{{manager_update_attendance}}" class="nav-link {% if manager_update_attendance == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-edit"></i>
                                <p>Update Attendance</p>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="{{manager_take_attendance}}" class="nav-link {% if manager_take_attendance == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-clipboard-check"></i>
                                <p>Take Attendance</p>
                            </a>
                        </li>
                        
                    </ul>
                </li>

                {% url 'manager_assign_task' as manager_assign_task %}
                {% url 'manager_view_tasks' as manager_view_tasks %}
                <li class="nav-item has-treeview {% if manager_assign_task == request.path or manager_view_tasks == request.path %} menu-open {% endif %}">
                    <a href="#" class="nav-link {% if manager_assign_task == request.path or manager_view_tasks == request.path %} active {% endif %}">
                        <i class="nav-icon fas fa-tasks"></i>
                        <p>
                            Task Management
                            <i class="right fas fa-angle-left"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a href="{{ manager_assign_task }}" class="nav-link {% if manager_assign_task == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-clipboard-list"></i>
                                <p>Assign Task</p>
                            </a>
                        </li>
                
                        <li class="nav-item">
                            <a href="{{ manager_view_tasks }}" class="nav-link {% if manager_view_tasks == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-list"></i>
                                <p>View Tasks</p>
                            </a>
                        </li>
                    </ul>
                </li>

                {% url 'manager_add_salary' as manager_add_salary %}
                {% url 'edit_employee_salary' as edit_employee_salary %}
                <li class="nav-item has-treeview {% if manager_add_salary == request.path or edit_employee_salary == request.path %} menu-open {% endif %}">
                    <a href="#" class="nav-link {% if manager_add_salary == request.path or edit_employee_salary == request.path %} active {% endif %}">
                        <i class="nav-icon fas fa-money-bill-wave"></i>
                        <p>
                            Salary Management
                            <i class="right fas fa-angle-left"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview">
                        <li class="nav-item">
                            <a href="{{manager_add_salary}}" class="nav-link {% if manager_add_salary == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-plus-circle"></i>
                                <p>Add Salary</p>
                            </a>
                        </li>  
                        <li class="nav-item">
                            <a href="{{edit_employee_salary}}" class="nav-link {% if edit_employee_salary == request.path %} active {% endif %}">
                                <i class="nav-icon fas fa-edit"></i>
                                <p>Edit Salary</p>
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="nav-item">
                    {% url 'manager_view_notification' as manager_view_notification %}
                    <a href="{{manager_view_notification}}" class="nav-link {% if request.path == manager_view_notification %} active {% endif %}">
                        <i class="nav-icon far fa-bell"></i>
                        <p>
                            Notifications
                            {% if notification_count > 0 %}
                            <span class="badge badge-danger right">{{ notification_count }}</span>
                            {% endif %}
                        </p>
                    </a>
                </li>

                <li class="nav-item">
                    {% url 'manager_view_attendance' as manager_view_attendance %}
                    <a href="{{manager_view_attendance}}" class="nav-link {% if manager_view_attendance == request.path %} active {% endif %}">
                        <i class="nav-icon fas fa-calendar-check"></i>
                        <p>View Attendance</p>
                    </a>
                </li>

                <li class="nav-item">
                    {% url 'manager_apply_leave' as manager_apply_leave %}
                    <a href="{{manager_apply_leave}}" class="nav-link {% if request.path == manager_apply_leave %} active {% endif %}">
                        <i class="nav-icon fas fa-envelope-open-text"></i>
                        <p>
                            Apply for Leave
                            {% if pending_leave_count > 0 %}
                            <span class="badge badge-warning right">{{ pending_leave_count }}</span>
                            {% endif %}
                        </p>
                    </a>
                </li>

                <li class="nav-item">
                    {% url 'manager_feedback' as manager_feedback %}
                    <a href="{{manager_feedback}}" class="nav-link {% if request.path == manager_feedback %} active {% endif %}">
                        <i class="nav-icon fas fa-comment-dots"></i>
                        <p>
                            Feedback
                            {% if feedback_count > 0 %}
                            <span class="badge badge-danger right">{{ feedback_count }}</span>
                            {% endif %}
                        </p>
                    </a>
                </li>

                
          
{% else %}
    <!-- Brand Logo -->
    <a href="{% url 'employee_home' %}" class="brand-link">
        <img src="{% static 'dist/img/AdminLTELogo.png' %}" alt="AdminLTE Logo"
            class="brand-image img-circle elevation-3" style="opacity: .8">
        <span class="brand-text font-weight-light">Employee Panel</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
        <!-- Sidebar user panel (optional) -->
        <div class="user-panel mt-3 pb-3 mb-3 d-flex">
            <div class="image">
                <img src="{{ request.user.profile_pic}}" class="img-circle elevation-2 pulse-avatar" alt="User Image">
            </div>
            <div class="info">
                {% url 'employee_view_profile' as employee_view_profile %}
                <a href="{{employee_view_profile}}" class="d-block text-bold">{{user}}</a>
            </div>
        </div>

        <!-- Sidebar Menu -->
        <nav class="mt-2">
            <ul class="nav nav-pills nav-sidebar flex-column nav-child-indent nav-compact" data-widget="treeview" role="menu" data-accordion="false">

                <li class="nav-item">
                    {% url 'employee_home' as employee_home %}
                    <a href="{{employee_home}}" class="nav-link {% if employee_home == request.path %} active {% endif %}">
                        <i class="nav-icon fas fa-home"></i>
                        <p>Home</p>
                    </a>
                </li>

                <li class="nav-item">
                    {% url 'employee_view_salary' as employee_view_salary %}
                    <a href="{% url 'employee_view_salary' %}" class="nav-link {% if employee_view_salary == request.path %} active {% endif %}">
                        <i class="nav-icon fas fa-money-bill-alt"></i>
                        <p>View Salary</p>
                    </a>
                </li>
          
                <li class="nav-item">
                    {% url 'employee_view_attendance' as employee_view_attendance %}
                    <a href="{{employee_view_attendance}}" class="nav-link {% if employee_view_attendance == request.path %} active {% endif %}">
                        <i class="nav-icon fas fa-calendar-check"></i>
                        <p>View Attendance</p>
                    </a>
                </li>

                {% url 'employee_apply_leave' as employee_apply_leave %}
                <li class="nav-item">
                    <a href="{{employee_apply_leave}}" class="nav-link {% if request.path == employee_apply_leave %} active {% endif %}">
                        <i class="nav-icon fas fa-envelope-open-text"></i>
                        <p>
                            Apply For Leave
                            {% if pending_leave_count > 0 %}
                            <span class="badge badge-warning right">{{ pending_leave_count }}</span>
                            {% endif %}
                        </p>
                    </a>
                </li>
                {% url 'employee_feedback' as employee_feedback %}
                <li class="nav-item">
                    <a href="{{employee_feedback}}" class="nav-link {% if request.path == employee_feedback %} active {% endif %}">
                        <i class="nav-icon fas fa-comment"></i>
                        <p>
                            Feedback
                            {% if feedback_count > 0 %}
                            <span class="badge badge-danger right">{{ feedback_count }}</span>
                            {% endif %}
                        </p>
                    </a>
                </li>
                {% url 'employee_view_notification' as employee_view_notification %}
                <li class="nav-item">
                    <a href="{{employee_view_notification}}" class="nav-link {% if request.path == employee_view_notification %} active {% endif %}">
                        <i class="nav-icon far fa-bell"></i>
                        <p>
                            Notifications
                            {% if notification_count > 0 %}
                            <span class="badge badge-danger right">{{ notification_count }}</span>
                            {% endif %}
                        </p>
                    </a>
                </li>
                {% url 'employee_view_tasks' as employee_view_tasks %}
                <li class="nav-item">
                    <a href="{{employee_view_tasks}}" class="nav-link {% if request.path == employee_view_tasks %} active {% endif %}">
                        <i class="nav-icon fas fa-tasks"></i>
                        <p>
                            My Tasks
                            {% if task_count > 0 %}
                            <span class="badge badge-danger right">{{ task_count }}</span>
                            {% endif %}
                        </p>
                    </a>
                </li>
                
                <li class="nav-item">
                    {% url 'employee_rank_report' as employee_rank_report %}
                    <a href="{{ employee_rank_report }}" class="nav-link {% if employee_rank_report == request.path %} active {% endif %}">
                        <i class="nav-icon fas fa-chart-line"></i>
                        <p>Performance Report</p>
                    </a>
                </li>
                
        
          
{% endif %}

<!-- Logout Button - Common to all user types -->
<li class="nav-item">
    <a href="{% url 'user_logout' %}" onclick="return confirm('Your session would be terminated.\n\nProceed?')" class="nav-link logout-link">
        <i class="nav-icon fas fa-sign-out-alt"></i>
        <p>Logout</p>
    </a>
</li>
</ul>
</nav>
<!-- /.sidebar-menu -->
</div>
<!-- /.sidebar -->
</aside>

<style>
    /* Sidebar animations and styling */
    .nav-sidebar .nav-item {
        transition: all 0.3s ease;
    }
    
    .nav-sidebar .nav-link {
        border-radius: 5px;
        margin: 2px 5px;
        transition: all 0.2s ease-in-out;
        padding: 0.5rem 1rem;
    }
    
    /* Clear hover styling to keep consistent positioning */
    .nav-sidebar .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.3);
        transform: none;
    }
    
    /* Strong highlighting for active parent items */
    .nav-sidebar > .nav-item > .nav-link.active {
        background-color: #007bff !important; /* Blue color for parent nav links */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        font-weight: bold;
        color: white !important;
        border-left: 4px solid #fff;
    }
    
    /* Slightly different highlighting for active child items */
    .nav-treeview .nav-link.active {
        background-color: #4da3ff !important; /* Lighter blue for child nav links */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        font-weight: bold;
        color: white !important;
        border-left: 4px solid #fff;
    }
    
    /* Allow submenus to collapse/expand */
    .nav-sidebar .nav-item .nav-treeview {
        display: block;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
        padding-left: 10px;
        border-left: 1px solid rgba(255, 255, 255, 0.3);
        margin-left: 10px;
    }
    
    /* Open state for submenus */
    .nav-sidebar .nav-item.menu-open > .nav-treeview {
        max-height: 1000px;
    }
    
    /* Keep submenu open when it contains active item */
    .nav-sidebar .nav-item.has-active-child > .nav-treeview {
        max-height: 1000px !important;
    }
    
    /* Make parent menu items of active items also highlighted */
    .nav-item.has-active-child > .nav-link {
        background-color: rgba(0, 123, 255, 0.2); /* Light blue background for parent with active child */
        border-left: 3px solid #007bff;
    }
    
    /* Special indicator for active parent elements */
    .nav-item.has-active-child > .nav-link::before {
        content: '►';
        position: absolute;
        left: 5px;
        color:  blue;
        font-size: 10px;
    }
    
    /* Pulse animation only for profile pictures */
    .pulse-avatar {
        animation: pulse 2s infinite;
    }
    
    /* Consistent styling for logout button */
    .logout-link {
        color: #fff !important;
        margin-top: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding-top: 10px !important;
    }
    
    .logout-link:hover {
        background-color: rgba(220, 53, 69, 0.7) !important;
        color: #fff !important;
    }
    
    @keyframes pulse {
        0% {
            box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4);
        }
        70% {
            box-shadow: 0 0 0 6px rgba(255, 255, 255, 0);
        }
        100% {
            box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
        }
    }
    
    /* Visual separation between menu sections */
    .nav-header {
        padding: 10px 5px 5px 15px;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.5);
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    /* Improve sidebar scrolling */
    .sidebar {
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: #6c757d transparent;
        height: calc(100vh - 56px);
    }
    
    .sidebar::-webkit-scrollbar {
        width: 5px;
    }
    
    .sidebar::-webkit-scrollbar-track {
        background: transparent;
    }
    
    .sidebar::-webkit-scrollbar-thumb {
        background-color: #6c757d;
        border-radius: 20px;
    }
    
    /* Brand styling */
    .brand-link {
        padding: 0.8rem 0.5rem;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* User panel styling */
    .user-panel {
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .user-panel .info a {
        transition: color 0.3s ease;
    }
    
    .user-panel .info a:hover {
        color: #007bff !important; /* Change hover color to blue to match the new theme */
    }
    
    /* Icon styling for consistency */
    .nav-sidebar .nav-icon {
        text-align: center;
        width: 1.6rem !important;
        margin-right: 0.2rem;
    }
</style>

<script>
    $(document).ready(function() {
        // Mark all parent menu items of active items
        function markActiveMenuParents() {
            // First, mark all menu items with active children
            $('.nav-link.active').each(function() {
                // Add classes to parent items
                $(this).parents('.nav-item').addClass('has-active-child');
                
                // Force open menus that contain active items
                var $parentTreeview = $(this).closest('.nav-treeview');
                if ($parentTreeview.length) {
                    $parentTreeview.parent('.nav-item').addClass('menu-open');
                }
            });
        }
        
        // Apply active parent classes on page load
        markActiveMenuParents();
        
        // Add padding to active links for better visibility
        $('.nav-link.active').css('padding-left', '20px');
        
        // Override AdminLTE's default click handler
        $('.nav-sidebar .nav-item > .nav-link').off('click');
        
        // Add our own accordion-style dropdown handler
        $('.nav-sidebar .nav-item > .nav-link').on('click', function(e) {
            if ($(this).next('.nav-treeview').length) {
                e.preventDefault();
                
                var $currentItem = $(this).parent();
                
                // If this item contains the active submenu, just keep it open
                if ($currentItem.hasClass('has-active-child')) {
                    return;
                }
                
                // If it's already open, close it
                if ($currentItem.hasClass('menu-open')) {
                    $currentItem.removeClass('menu-open');
                    return;
                }
                
                // Otherwise, close all others at same level and open this one
                $currentItem.siblings('.nav-item.has-treeview').not('.has-active-child').removeClass('menu-open');
                $currentItem.addClass('menu-open');
            }
        });
        
        // Make sure the relevant menu items are open on page load
        setTimeout(function() {
            markActiveMenuParents();
        }, 100);
    });
</script>
